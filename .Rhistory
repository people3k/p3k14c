sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$n) %>%
plot()
radiocarbon_dates_ppp
radiocarbon_dates_ppp$marks
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates) %>%
plot()
radiocarbon_dates_ppp$marks$Dates
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates) %>%
plot()
world_kde_dates <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle")
world_kde_sites <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
weights = .x$marks$Dates)
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
world_kde_sites <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates)
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
risk(world_kde_dates,world_kde_sites, tolerate = TRUE) %>% plot()
plot(windows$World, add = TRUE)
# Spatial windows for risk analysis
windows <-
list(
# Global land area (EPSG 8857)
`World` =
rnaturalearth::ne_countries(returnclass = "sf") %>%
dplyr::select(geometry) %>%
sf::st_transform("EPSG:8857") %>%
sf::st_union(),
# Northwestern Europe in Albers Equal Area Conic (ESRI 102013)
`Northwestern Europe` =
rnaturalearth::ne_states(country = c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg"),
returnclass = "sf") %>%
dplyr::filter(!(name %in% c("Guyane française",
"Martinique",
"Guadeloupe",
"St. Eustatius",
"Saba",
"Haute-Corse",
"Corse-du-Sud",
"Mayotte",
"La Réunion"))) %>%
dplyr::select(geometry) %>%
sf::st_transform("ESRI:102013") %>%
sf::st_union(),
# Contiguous USA in Albers Equal Area Conic (ESRI 102003)
`United States` =
rnaturalearth::ne_states(country = "United States of America",
returnclass = "sf") %>%
dplyr::filter(!(name %in% c("Hawaii",
"Alaska")))%>%
sf::st_transform("ESRI:102003") %>%
sf::st_union()) %>%
purrr::map(sf::st_cast,
"MULTIPOLYGON")
plot(windows$World, add = TRUE)
?rish
?risk
plot(world_kde_dates)
?OS
?bivariate.density
?MASS::kde2d
radiocarbon_dates_ppp
windows$World
windows$World %>% sf::st_crs()
world_kde_dates
?bivariate.density
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp")
world_kde_dates <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
resolution = 1000)
plot(world_kde_dates)
radiocarbon_dates
world_kde_dates <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
resolution = 2000)
world_kde_sites <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_risk <-
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
plot(world_kde_dates)
plot(world_kde_sites)
plot(world_risk)
sf::st_bbox(c(xmin = -180,xmax = 180,ymin = -90,ymax = 90))
sf::st_bbox(c(xmin = -180,xmax = 180,ymin = -90,ymax = 90), crs = 4326)
sf::st_bbox(c(xmin = -180,xmax = 180,ymin = -90,ymax = 90), crs = 4326) %>%
sf::st_as_sfc()
sf::st_bbox(c(xmin = -180,xmax = 180,ymin = -90,ymax = 90), crs = 4326) %>%
sf::st_as_sfc() %>%
sf::st_transform(8857)
sf::st_bbox(c(xmin = -180,xmax = 180,ymin = -90,ymax = 90), crs = 4326) %>%
sf::st_as_sfc() %>%
sf::st_transform(8857) %>%
sf::st_bbox()
sf::st_bbox(c(xmin = -180,xmax = 180,ymin = -90,ymax = 90), crs = 4326) %>%
sf::st_as_sfc() %>%
sf::st_transform(8857) %>%
as("Spatial") %>%
as("owin")
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp") %>%
window(sf::st_bbox(c(xmin = -180,xmax = 180,ymin = -90,ymax = 90), crs = 4326) %>%
sf::st_as_sfc() %>%
sf::st_transform(8857) %>%
as("Spatial") %>%
as("owin"))
world_kde_dates <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
resolution = 2000)
world_kde_sites <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_risk <-
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
plot(world_kde_dates)
plot(world_kde_sites)
plot(world_risk)
plot(windows$World, add = TRUE)
windows$World
windows$World %>%
sf::st_bbox() %>%
as("Spatial")
windows$World %>%
sf::st_bbox() %>%
sf::at_as_sfc() %>%
as("Spatial")
windows$World %>%
sf::st_bbox() %>%
sf::st_as_sfc() %>%
as("Spatial")
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp") %>%
window(windows$World %>%
sf::st_bbox() %>%
sf::st_as_sfc() %>%
as("Spatial") %>%
as("owin"))
world_kde_dates <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
resolution = 2000)
world_kde_sites <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = .,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_risk <-
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
plot(world_kde_dates)
plot(world_kde_sites)
plot(world_risk)
plot(windows$World, add = TRUE)
radiocarbon_dates_ppp %>%
sparr::OS()
windows <-
list(
# Global land area (EPSG 8857)
`World` =
rnaturalearth::ne_countries(returnclass = "sf") %>%
dplyr::select(geometry) %>%
sf::st_transform("EPSG:8857") %>%
sf::st_union(),
# Northwestern Europe in Albers Equal Area Conic (ESRI 102013)
`Northwestern Europe` =
rnaturalearth::ne_states(country = c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg"),
returnclass = "sf") %>%
dplyr::filter(!(name %in% c("Guyane française",
"Martinique",
"Guadeloupe",
"St. Eustatius",
"Saba",
"Haute-Corse",
"Corse-du-Sud",
"Mayotte",
"La Réunion"))) %>%
dplyr::select(geometry) %>%
sf::st_transform("ESRI:102013") %>%
sf::st_union(),
# Contiguous USA in Albers Equal Area Conic (ESRI 102003)
`United States` =
rnaturalearth::ne_states(country = "United States of America",
returnclass = "sf") %>%
dplyr::filter(!(name %in% c("Hawaii",
"Alaska")))%>%
sf::st_transform("ESRI:102003") %>%
sf::st_union()) %>%
purrr::map(sf::st_cast,
"MULTIPOLYGON") %>%
# OWIN transform
purrr::map(~(
.x %>%
sf::st_transform(8857) %>%
as("Spatial") %>%
as("owin")
))
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp") %>%
window(windows$`United States`)
radiocarbon_dates_ppp %>%
sparr::OS()
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp") %>%
window(windows$`Northwestern Europe`)
radiocarbon_dates_ppp %>%
sparr::OS()
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp") %>%
window(windows$World %>%
sf::st_bbox() %>%
sf::st_as_sfc() %>%
as("Spatial") %>%
as("owin"))
world_kde_dates <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 100000,
adapt = FALSE,
edge = "diggle",
resolution = 2000)
world_kde_sites <-
radiocarbon_dates_ppp %>%
sparr::OS() %>%
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 100000,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_risk <-
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
plot(world_kde_dates)
plot(world_kde_sites)
plot(world_risk)
plot(windows$World, add = TRUE)
world_kde_dates <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 100000,
adapt = FALSE,
edge = "diggle",
resolution = 2000)
world_kde_sites <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 100000,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_risk <-
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
plot(world_kde_dates)
plot(world_kde_sites)
plot(world_risk)
plot(windows$World, add = TRUE)
world_kde_dates <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 100000,
adapt = FALSE,
edge = "diggle",
resolution = 2000)
world_kde_sites <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 100000,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_risk <-
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
plot(world_kde_dates)
plot(world_kde_sites)
plot(world_risk)
plot(windows$World, add = TRUE)
plot(world_kde_dates)
dev.off()
plot(world_kde_dates)
radiocarbon_dates_ppp
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp") %>%
window(windows$World %>%
sf::st_bbox() %>%
sf::st_as_sfc() %>%
as("Spatial") %>%
as("owin"))
windows$World
# Spatial windows for risk analysis
windows <-
list(
# Global land area (EPSG 8857)
`World` =
rnaturalearth::ne_countries(returnclass = "sf") %>%
dplyr::select(geometry) %>%
sf::st_transform("EPSG:8857") %>%
sf::st_union(),
# Northwestern Europe in Albers Equal Area Conic (ESRI 102013)
`Northwestern Europe` =
rnaturalearth::ne_states(country = c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg"),
returnclass = "sf") %>%
dplyr::filter(!(name %in% c("Guyane française",
"Martinique",
"Guadeloupe",
"St. Eustatius",
"Saba",
"Haute-Corse",
"Corse-du-Sud",
"Mayotte",
"La Réunion"))) %>%
dplyr::select(geometry) %>%
sf::st_transform("ESRI:102013") %>%
sf::st_union(),
# Contiguous USA in Albers Equal Area Conic (ESRI 102003)
`United States` =
rnaturalearth::ne_states(country = "United States of America",
returnclass = "sf") %>%
dplyr::filter(!(name %in% c("Hawaii",
"Alaska")))%>%
sf::st_transform("ESRI:102003") %>%
sf::st_union()) %>%
purrr::map(sf::st_cast,
"MULTIPOLYGON")# %>%
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp") %>%
window(windows$World %>%
sf::st_bbox() %>%
sf::st_as_sfc() %>%
as("Spatial") %>%
as("owin"))
world_kde_dates <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 100000,
adapt = FALSE,
edge = "diggle",
resolution = 2000)
world_kde_sites <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 100000,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_risk <-
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
plot(world_kde_dates)
plot(world_kde_sites)
plot(world_risk)
plot(windows$World, add = TRUE)
?risk
radiocarbon_dates_ppp <-
radiocarbon_dates %>%
as("Spatial") %>%
as("ppp") %>%
window(windows$World %>%
sf::st_bbox() %>%
sf::st_as_sfc() %>%
as("Spatial") %>%
as("owin"))
world_kde_dates <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 200000,
adapt = FALSE,
edge = "diggle",
resolution = 2000)
world_kde_sites <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 200000,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_risk <-
risk(world_kde_dates,world_kde_sites, tolerate = TRUE)
plot(world_kde_dates)
plot(world_kde_sites)
plot(world_risk)
plot(windows$World, add = TRUE)
world_kde_sites
world_kde_sites$z
raster::raster(world_kde_sites$z)
raster::plot(raster::raster(world_kde_sites$z))
sf::st_crs("EPSG:8857")
raster::crs(world_kde_sites) <- sf::st_crs("EPSG:8857")
world_kde_sites <-
world_kde_sites$z %>%
raster::raster()
raster::crs(world_kde_sites) <- sf::st_crs("EPSG:8857")
world_kde_sites
as(sf::st_crs("EPSG:8857"), "CRS")
raster::crs(world_kde_sites) <- as(sf::st_crs("EPSG:8857"), "CRS")
world_kde_sites
plot(world_kde_sites)
world_kde_sites[world_kde_sites == 0] <- NA
plot(world_kde_sites)
world_kde_sites[1]
world_kde_sites[world_kde_sites < 0] <- NA
world_kde_sites
plot(world_kde_sites)
world_kde_sites[world_kde_sites < 1e-10] <- NA
plot(world_kde_sites)
world_kde_sites <-
bivariate.density(pp = radiocarbon_dates_ppp,
h0 = 200000,
adapt = FALSE,
edge = "diggle",
weights = radiocarbon_dates_ppp$marks$Dates,
resolution = 2000)
world_kde_sites <-
world_kde_sites$z %>%
raster::raster()
raster::crs(world_kde_sites) <- as(sf::st_crs("EPSG:8857"), "CRS")
plot(world_kde_sites[world_kde_sites > 1e-30])
plot(world_kde_sites[world_kde_sites > 1e-36])
