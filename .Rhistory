list(`Northwestern Europe` =
rnaturalearth::ne_states(country = c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg"),
returnclass = "sf") %>%
dplyr::filter(geonunit %in% c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg")),
`Desert US` =
rnaturalearth::ne_states(country = "United States of America",
returnclass = "sf") %>%
dplyr::filter(name %in% c("Idaho",
"Colorado",
"Utah",
"Arizona",
"New Mexico",
"Wyoming",
"Nevada"))) %>%
purrr::map(~(
.x %>%
sf::st_transform(8857) %>%
as("Spatial") %>%
as("owin")
))
# reproject point data and prepare individual ppp for KDE analyses
# europe
kde_dates <-
windows %>%
purrr::map(~window(scipap %>%
sf::st_transform(8857) %>%
as("Spatial") %>%
as("ppp"),
.x)) %>%
purrr::map(~(
.x %>%
sparr::OS() %>%
bivariate.density(pp = .x,
h0 = .,
adapt = FALSE,
edge = "diggle")
))
#### sensitivity (including kde) analysis fo SciPaper####
# install.packages("devtools")
# install.packages("purrr")
# install.packages("magrittr")
library(magrittr)
c(
"readr",
"tibble",
"tidyr",
"dplyr",
"sf",
"sparr",
"spatstat",
"magrittr",
"ggplot2",
"maptools"
) %T>%
purrr::walk(devtools::install_cran,
quiet = TRUE
) %>%
purrr::walk(library,
character.only = TRUE
)
# Functions
window.ppp <- function(x, w){
spatstat.geom::Window(x) <- w
x
}
# data
scipap <-
"data/raw_data/radiocarbon_dates_scrubbedv5_1.csv" %>%
here::here() %>%
readr::read_csv(col_types =
readr::cols(
Age = readr::col_double(),
Error = readr::col_double(),
Long = readr::col_double(),
Lat = readr::col_double(),
.default = readr::col_character()
)) %>%
tidyr::drop_na(Long, Lat) %>%
dplyr::mutate(
Region = NA,
Region = ifelse(Continent == "Europe",
"Europe",
Region
),
Region = ifelse(Country == "USA",
"United States",
Region
)
) %>%
dplyr::count(Region,
SiteName,
Long,
Lat) %>%
sf::st_as_sf(
coords = c("Long", "Lat"),
crs = 4326
)
# Count dates/sites
scipap %>%
sf::st_drop_geometry() %>%
dplyr::group_by(Region) %>%
dplyr::summarise(Dates = sum(n, na.rm = TRUE),
Sites = dplyr::n())
# windows
windows <-
list(`Northwestern Europe` =
rnaturalearth::ne_states(country = c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg"),
returnclass = "sf") %>%
dplyr::filter(geonunit %in% c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg")),
`Desert US` =
rnaturalearth::ne_states(country = "United States of America",
returnclass = "sf") %>%
dplyr::filter(name %in% c("Idaho",
"Colorado",
"Utah",
"Arizona",
"New Mexico",
"Wyoming",
"Nevada"))) %>%
purrr::map(~(
.x %>%
sf::st_transform(8857) %>%
as("Spatial") %>%
as("owin")
))
# windows
windows <-
list(`Northwestern Europe` =
rnaturalearth::ne_states(country = c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg"),
returnclass = "sf") %>%
dplyr::filter(geonunit %in% c("Netherlands",
"Belgium",
"Denmark",
"France",
"Germany",
"Luxembourg")),
`Desert US` =
rnaturalearth::ne_states(country = "United States of America",
returnclass = "sf") %>%
dplyr::filter(name %in% c("Idaho",
"Colorado",
"Utah",
"Arizona",
"New Mexico",
"Wyoming",
"Nevada"))) %>%
purrr::map(~(
.x %>%
sf::st_transform(8857) %>%
as("Spatial") %>%
as("owin")
))
#### sensitivity (including kde) analysis fo SciPaper####
# install.packages("devtools")
# install.packages("purrr")
# install.packages("magrittr")
library(magrittr)
c(
"readr",
"tibble",
"tidyr",
"dplyr",
"sf",
"sparr",
"spatstat",
"magrittr",
"ggplot2",
"maptools"
) %T>%
purrr::walk(devtools::install_cran,
quiet = TRUE
) %>%
purrr::walk(library,
character.only = TRUE
)
#### sensitivity (including kde) analysis fo SciPaper####
# install.packages("devtools")
# install.packages("purrr")
# install.packages("magrittr")
library(magrittr)
c(
"readr",
"tibble",
"tidyr",
"dplyr",
"sf",
"sparr",
"spatstat",
"magrittr",
"ggplot2",
"maptools"
) %T>%
purrr::walk(devtools::install_cran,
quiet = TRUE
) %>%
purrr::walk(library,
character.only = TRUE
)
c(
"readr",
"tibble",
"tidyr",
"dplyr",
"sf",
"sparr",
"spatstat",
"magrittr",
"ggplot2",
"maptools"
) %T>%
purrr::walk(devtools::install_cran,
quiet = TRUE
) %>%
purrr::walk(library,
character.only = TRUE
)
# Functions
window.ppp <- function(x, w){
spatstat.geom::Window(x) <- w
x
}
# data
scipap <-
"data/raw_data/radiocarbon_dates_scrubbedv5_1.csv" %>%
here::here() %>%
readr::read_csv(col_types =
readr::cols(
Age = readr::col_double(),
Error = readr::col_double(),
Long = readr::col_double(),
Lat = readr::col_double(),
.default = readr::col_character()
)) %>%
tidyr::drop_na(Long, Lat) %>%
dplyr::mutate(
Region = NA,
Region = ifelse(Continent == "Europe",
"Europe",
Region
),
Region = ifelse(Country == "USA",
"United States",
Region
)
) %>%
dplyr::count(Region,
SiteName,
Long,
Lat) %>%
sf::st_as_sf(
coords = c("Long", "Lat"),
crs = 4326
)
# Count dates/sites
scipap %>%
sf::st_drop_geometry() %>%
dplyr::group_by(Region) %>%
dplyr::summarise(Dates = sum(n, na.rm = TRUE),
Sites = dplyr::n())
install.packages(c("backports", "boot", "brms", "broom", "cachem", "cli", "crayon", "crul", "data.table", "dbplyr", "deldir", "desc", "DescTools", "distributional", "dotCall64", "e1071", "effectsize", "farver", "forecast", "gert", "ggeffects", "ggforce", "ggsignif", "Hmisc", "insight", "isoband", "kableExtra", "ks", "lubridate", "maptools", "MASS", "MatrixModels", "mime", "parallelly", "parameters", "pbkrtest", "performance", "pkgload", "promises", "proxy", "ps", "quantreg", "rcarbon", "RcppArmadillo", "RcppParallel", "RCurl", "rgdal", "rio", "rmarkdown", "rstatix", "rticles", "rvest", "seasonal", "SparseM", "spatstat.linnet", "spatstat.sparse", "stars", "testthat", "tinytex", "units", "usethis", "utf8", "waldo", "wk", "xfun", "XML", "zoo"))
install.packages(c("backports", "boot", "brms", "broom", "cachem", "cli", "crayon", "crul", "data.table", "dbplyr", "deldir", "desc", "DescTools", "distributional", "dotCall64", "e1071", "effectsize", "farver", "forecast", "gert", "ggeffects", "ggforce", "ggsignif", "Hmisc", "insight", "isoband", "kableExtra", "ks", "lubridate", "maptools", "MASS", "MatrixModels", "mime", "parallelly", "parameters", "pbkrtest", "performance", "pkgload", "promises", "proxy", "ps", "quantreg", "rcarbon", "RcppArmadillo", "RcppParallel", "RCurl", "rgdal", "rio", "rmarkdown", "rstatix", "rticles", "rvest", "seasonal", "SparseM", "spatstat.linnet", "spatstat.sparse", "stars", "testthat", "tinytex", "units", "usethis", "utf8", "waldo", "wk", "xfun", "XML", "zoo"))
install.packages(c("backports", "boot", "brms", "broom", "cachem", "cli", "crayon", "crul", "data.table", "dbplyr", "deldir", "desc", "DescTools", "distributional", "dotCall64", "e1071", "effectsize", "farver", "forecast", "gert", "ggeffects", "ggforce", "ggsignif", "Hmisc", "insight", "isoband", "kableExtra", "ks", "lubridate", "maptools", "MASS", "MatrixModels", "mime", "parallelly", "parameters", "pbkrtest", "performance", "pkgload", "promises", "proxy", "ps", "quantreg", "rcarbon", "RcppArmadillo", "RcppParallel", "RCurl", "rgdal", "rio", "rmarkdown", "rstatix", "rticles", "rvest", "seasonal", "SparseM", "spatstat.linnet", "spatstat.sparse", "stars", "testthat", "tinytex", "units", "usethis", "utf8", "waldo", "wk", "xfun", "XML", "zoo"))
install.packages(c("backports", "boot", "brms", "broom", "cachem", "cli", "crayon", "crul", "data.table", "dbplyr", "deldir", "desc", "DescTools", "distributional", "dotCall64", "e1071", "effectsize", "farver", "forecast", "gert", "ggeffects", "ggforce", "ggsignif", "Hmisc", "insight", "isoband", "kableExtra", "ks", "lubridate", "maptools", "MASS", "MatrixModels", "mime", "parallelly", "parameters", "pbkrtest", "performance", "pkgload", "promises", "proxy", "ps", "quantreg", "rcarbon", "RcppArmadillo", "RcppParallel", "RCurl", "rgdal", "rio", "rmarkdown", "rstatix", "rticles", "rvest", "seasonal", "SparseM", "spatstat.linnet", "spatstat.sparse", "stars", "testthat", "tinytex", "units", "usethis", "utf8", "waldo", "wk", "xfun", "XML", "zoo"))
install.packages(c("backports", "boot", "brms", "broom", "cachem", "cli", "crayon", "crul", "data.table", "dbplyr", "deldir", "desc", "DescTools", "distributional", "dotCall64", "e1071", "effectsize", "farver", "forecast", "gert", "ggeffects", "ggforce", "ggsignif", "Hmisc", "insight", "isoband", "kableExtra", "ks", "lubridate", "maptools", "MASS", "MatrixModels", "mime", "parallelly", "parameters", "pbkrtest", "performance", "pkgload", "promises", "proxy", "ps", "quantreg", "rcarbon", "RcppArmadillo", "RcppParallel", "RCurl", "rgdal", "rio", "rmarkdown", "rstatix", "rticles", "rvest", "seasonal", "SparseM", "spatstat.linnet", "spatstat.sparse", "stars", "testthat", "tinytex", "units", "usethis", "utf8", "waldo", "wk", "xfun", "XML", "zoo"))
install.packages(c("backports", "boot", "brms", "broom", "cachem", "cli", "crayon", "crul", "data.table", "dbplyr", "deldir", "desc", "DescTools", "distributional", "dotCall64", "e1071", "effectsize", "farver", "forecast", "gert", "ggeffects", "ggforce", "ggsignif", "Hmisc", "insight", "isoband", "kableExtra", "ks", "lubridate", "maptools", "MASS", "MatrixModels", "mime", "parallelly", "parameters", "pbkrtest", "performance", "pkgload", "promises", "proxy", "ps", "quantreg", "rcarbon", "RcppArmadillo", "RcppParallel", "RCurl", "rgdal", "rio", "rmarkdown", "rstatix", "rticles", "rvest", "seasonal", "SparseM", "spatstat.linnet", "spatstat.sparse", "stars", "testthat", "tinytex", "units", "usethis", "utf8", "waldo", "wk", "xfun", "XML", "zoo"))
install.packages(c("backports", "boot", "brms", "broom", "cachem", "cli", "crayon", "crul", "data.table", "dbplyr", "deldir", "desc", "DescTools", "distributional", "dotCall64", "e1071", "effectsize", "farver", "forecast", "gert", "ggeffects", "ggforce", "ggsignif", "Hmisc", "insight", "isoband", "kableExtra", "ks", "lubridate", "maptools", "MASS", "MatrixModels", "mime", "parallelly", "parameters", "pbkrtest", "performance", "pkgload", "promises", "proxy", "ps", "quantreg", "rcarbon", "RcppArmadillo", "RcppParallel", "RCurl", "rgdal", "rio", "rmarkdown", "rstatix", "rticles", "rvest", "seasonal", "SparseM", "spatstat.linnet", "spatstat.sparse", "stars", "testthat", "tinytex", "units", "usethis", "utf8", "waldo", "wk", "xfun", "XML", "zoo"))
#### sensitivity (including kde) analysis fo SciPaper####
# install.packages("devtools")
# install.packages("purrr")
# install.packages("magrittr")
library(magrittr)
c(
"readr",
"tibble",
"tidyr",
"dplyr",
"sf",
"sparr",
"spatstat",
"magrittr",
"ggplot2",
"maptools"
) %T>%
purrr::walk(devtools::install_cran,
quiet = TRUE
) %>%
purrr::walk(library,
character.only = TRUE
)
# Functions
window.ppp <- function(x, w){
spatstat.geom::Window(x) <- w
x
}
# data
scipap <-
"data/raw_data/radiocarbon_dates_scrubbedv5_1.csv" %>%
here::here() %>%
readr::read_csv(col_types =
readr::cols(
Age = readr::col_double(),
Error = readr::col_double(),
Long = readr::col_double(),
Lat = readr::col_double(),
.default = readr::col_character()
)) %>%
tidyr::drop_na(Long, Lat) %>%
dplyr::mutate(
Region = NA,
Region = ifelse(Continent == "Europe",
"Europe",
Region
),
Region = ifelse(Country == "USA",
"United States",
Region
)
) %>%
dplyr::count(Region,
SiteName,
Long,
Lat) %>%
sf::st_as_sf(
coords = c("Long", "Lat"),
crs = 4326
)
####sensitivity (including kde) analysis fo SciPaper####
#libraries
library(sparr)
library(sp)
library(sf)
library(tidyverse)
library(rnaturalearth)
library(maptools)
library(spatstat)
#data
scipap<-read.csv("/home/marc/Dropbox/m_pers/people3k/20210224/radiocarbon_dates_scrubbedv5_1.csv",header=TRUE)
scipap<-drop_na(scipap,Long,Lat)
#subset for various windows
#scipap.china<-filter(scipap,Country=="China")
#scipap.wa<-filter(scipap,Long>=-17&Long<=20&Lat>=-10&Lat<=15)
scipap.euro<-filter(scipap,Continent=="Europe")
#scipap.swa<-filter(scipap,Long>=-70&Long<=-57&Lat>=-30&Lat<=-23)
scipap.usa<-filter(scipap,Country=="USA")
#count sites
#scipap.china.c<-count(scipap.china,SiteName)
#scipap.china.c<-left_join(scipap.china.c,scipap.china,by="SiteName")
#scipap.china.c<-distinct(scipap.china.c,SiteName,.keep_all=TRUE)
#scipap.wa.c<-count(scipap.wa,SiteName)
#scipap.wa.c<-left_join(scipap.wa.c,scipap.wa,by="SiteName")
#scipap.wa.c<-distinct(scipap.wa.c,SiteName,.keep_all=TRUE)
scipap.euro.c<-count(scipap.euro,SiteName)
#subset for various windows
#scipap.china<-filter(scipap,Country=="China")
#scipap.wa<-filter(scipap,Long>=-17&Long<=20&Lat>=-10&Lat<=15)
scipap.euro<-filter(scipap,Continent=="Europe")
#scipap.swa<-filter(scipap,Long>=-70&Long<=-57&Lat>=-30&Lat<=-23)
scipap.usa<-filter(scipap,Country=="USA")
# data
scipap <-
"data/raw_data/radiocarbon_dates_scrubbedv5_1.csv" %>%
here::here() %>%
readr::read_csv(col_types =
readr::cols(
Age = readr::col_double(),
Error = readr::col_double(),
Long = readr::col_double(),
Lat = readr::col_double(),
.default = readr::col_character()
)) %>%
tidyr::drop_na(Long, Lat) %>%
dplyr::mutate(
Region = NA,
Region = ifelse(Continent == "Europe",
"Europe",
Region
),
Region = ifelse(Country == "USA",
"United States",
Region
)
) %>%
dplyr::count(Region,
SiteName,
Long,
Lat) %>%
sf::st_as_sf(
coords = c("Long", "Lat"),
crs = 4326
)
View(scipap)
View(scipap)
RC <- read_csv(
here::here("data/raw_data/scrubbed_5_1_joined.csv"),
col_types = "cddccdfddfcccfffcccc"
)
#### USA check ------
bounds <- read.csv(
here::here("data/raw_data/Qual_BoundingBoxes.csv")
) %>%
mutate(Region = as.factor(`ï..Region`)) %>%
# select(-`ï..Region`) %>%
select(Region, Country, Province) %>%
separate_rows(Province, sep = ", ") %>%
filter(Region %in% c(
"Whole Western US",
"Plains US" ,
"Desert West US",
"West Coast US")) %>%
mutate(Country = replace (Country, Country ==  "United States", "USA"))
USA_states <- read.csv(
here::here("data/raw_data/Qual_SiteCounts/USASiteCounts.csv")
) %>%
mutate(Province = State)
WEurSites <- RC %>%
dplyr::filter(Country %in% c(
"France",
"Netherlands",
"Germany",
"Switzerland",
"Belgium",
"Spain",
"Portugal",
"United Kingdom",
"Ireland"
)) %>%
dplyr::group_by(SiteName, SiteID, Lat, Long) %>%
dplyr::count() %>%
dplyr::ungroup() %>%
dplyr::rename(nDates = n) %>%
dplyr::distinct(SiteName, SiteID, Lat, Long)
View(WEurSites)
WEurSites <- RC %>%
dplyr::filter(Country %in% c(
"France",
"Netherlands",
"Germany",
"Switzerland",
"Belgium",
"Spain",
"Portugal",
"United Kingdom",
"Ireland"
)) %>%
dplyr::group_by(SiteName, SiteID, Lat, Long) %>%
dplyr::count() %>%
dplyr::ungroup()
WEurSites
View(WEurSites)
WEurSites <- RC %>%
dplyr::filter(Country %in% c(
"France",
"Netherlands",
"Germany",
"Switzerland",
"Belgium",
"Spain",
"Portugal",
"United Kingdom",
"Ireland"
)) %>%
dplyr::group_by(SiteName, SiteID, Lat, Long) %>%
dplyr::count() %>%
dplyr::ungroup() %>%
dplyr::rename(nDates = n)
WEurSites
source('C:/Users/Darcy/Dropbox/R/20_P3k14C/Marcp3k_risk2.R', echo=TRUE)
scipap<-RC
scipap<-drop_na(scipap,Long,Lat)
#subset for various windows
#scipap.china<-filter(scipap,Country=="China")
#scipap.wa<-filter(scipap,Long>=-17&Long<=20&Lat>=-10&Lat<=15)
scipap.euro<-filter(scipap,Continent=="Europe")
#scipap.swa<-filter(scipap,Long>=-70&Long<=-57&Lat>=-30&Lat<=-23)
scipap.usa<-filter(scipap,Country=="USA")
#count sites
#scipap.china.c<-count(scipap.china,SiteName)
#scipap.china.c<-left_join(scipap.china.c,scipap.china,by="SiteName")
#scipap.china.c<-distinct(scipap.china.c,SiteName,.keep_all=TRUE)
#scipap.wa.c<-count(scipap.wa,SiteName)
#scipap.wa.c<-left_join(scipap.wa.c,scipap.wa,by="SiteName")
#scipap.wa.c<-distinct(scipap.wa.c,SiteName,.keep_all=TRUE)
scipap.euro.c<-count(scipap.euro,SiteName)
scipap.euro.c<-left_join(scipap.euro.c,scipap.euro,by="SiteName")
scipap.euro.c<-distinct(scipap.euro.c,SiteName,.keep_all=TRUE)
scipap.euro.c
View(scipap.euro.c)
